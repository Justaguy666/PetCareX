// =======================================================================
// PetCareX Database Schema
// =======================================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// =======================================================================
// ENUMS
// =======================================================================

enum Gender {
  Nam
  Nu @map("Nữ")
}

enum PetGender {
  Duc  @map("Đực")
  Cai  @map("Cái")
}

enum MembershipLevel {
  CoBan      @map("Cơ bản")
  ThanThiet  @map("Thân thiết")
  VIP
}

enum HealthStatus {
  KhoeManh    @map("Khỏe mạnh")
  CoVanDe     @map("Có vấn đề")
  DangHoiPhuc @map("Đang hồi phục")
  ChuaRo      @map("Chưa rõ")
}

enum EmployeeRole {
  BacSiThuY          @map("Bác sĩ thú y")
  NhanVienTiepTan    @map("Nhân viên tiếp tân")
  NhanVienBanHang    @map("Nhân viên bán hàng")
  QuanLyChiNhanh     @map("Quản lý chi nhánh")
}

enum PaymentMethod {
  TienMat      @map("Tiền mặt")
  ChuyenKhoan  @map("Chuyển khoản")
}

enum ServiceType {
  KhamBenh     @map("Khám bệnh")
  TiemMuiLe    @map("Tiêm mũi lẻ")
  TiemTheoGoi  @map("Tiêm theo gói")
  MuaHang      @map("Mua hàng")
}

enum AppointmentServiceType {
  KhamBenh     @map("Khám bệnh")
  TiemMuiLe    @map("Tiêm mũi lẻ")
  TiemTheoGoi  @map("Tiêm theo gói")
}

enum ProductType {
  ThucAn   @map("Thức ăn")
  PhuKien  @map("Phụ kiện")
}

enum PromotionForLevel {
  TatCa            @map("Tất cả")
  ThanThietTroLen  @map("Thân thiết trở lên")
  VIP
}

enum Status {
  DangChoXacNhan @map("Đang chờ xác nhận")
  DaXacNhan      @map("Đã xác nhận")
  HoanThanh      @map("Hoàn thành")
  HuyBo          @map("Hủy bỏ")
}

// =======================================================================
// 1. USERS (Khách Hàng)
// =======================================================================

model User {
  id               BigInt           @id @default(autoincrement())
  fullName         String?          @map("full_name") @db.VarChar(50)
  email            String           @unique @db.VarChar(320)
  phoneNumber      String?          @unique @map("phone_number") @db.VarChar(10)
  citizenId        String?          @unique @map("citizen_id") @db.VarChar(12)
  gender           Gender?
  dateOfBirth      DateTime?        @map("date_of_birth") @db.Date
  membershipLevel  MembershipLevel  @default(CoBan) @map("membership_level")
  
  createdAt        DateTime         @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime         @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  account          Account?
  refreshTokens    RefreshToken[]
  pets             Pet[]             @relation("PetOwner")
  invoices         Invoice[]
  appointments     Appointment[]

  @@map("users")
}

model Account {
  userId          BigInt    @id @map("user_id")
  username        String    @unique @db.VarChar(255)
  hashedPassword  String    @map("hashed_password")
  isActive        Boolean   @default(false) @map("is_active")
  lastLoginAt     DateTime? @map("last_login_at") @db.Timestamptz(6)
  
  createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("accounts")
}

model RefreshToken {
  id         BigInt   @id @default(autoincrement())
  userId     BigInt   @map("user_id")
  token      String   @unique
  expiresAt  DateTime @map("expires_at") @db.Timestamptz(6)
  
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("refresh_tokens")
}

// =======================================================================
// 2. PETS (Thú Cưng)
// =======================================================================

model Pet {
  id            BigInt        @id @default(autoincrement())
  petName       String        @map("pet_name") @db.VarChar(50)
  species       String        @db.VarChar(50)
  breed         String?       @db.VarChar(50)
  dateOfBirth   DateTime?     @map("date_of_birth") @db.Date
  gender        PetGender
  ownerId       BigInt        @map("owner_id")
  healthStatus  HealthStatus  @default(ChuaRo) @map("health_status")
  
  createdAt     DateTime      @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime      @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  owner                User               @relation("PetOwner", fields: [ownerId], references: [id], onDelete: Restrict)
  medicalExaminations  MedicalExamination[]
  singleInjections     SingleInjection[]
  packageInjections    PackageInjection[]
  appointments         Appointment[]

  @@map("pets")
}

// =======================================================================
// 3. EMPLOYEES (Nhân Viên)
// =======================================================================

model Employee {
  id                   BigInt        @id @default(autoincrement())
  fullName             String        @map("full_name") @db.VarChar(50)
  dateOfBirth          DateTime      @map("date_of_birth") @db.Date
  gender               Gender
  role                 EmployeeRole
  baseSalary           Decimal       @map("base_salary") @db.Decimal(15, 2)
  
  createdAt            DateTime      @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt            DateTime      @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  managedBranch        Branch?
  mobilizations        Mobilization[]
  invoices             Invoice[]
  medicalExaminations  MedicalExamination[]
  singleInjections     SingleInjection[]
  packageInjections    PackageInjection[]
  appointments         Appointment[]

  @@map("employees")
}

// =======================================================================
// 4. BRANCHES (Chi Nhánh)
// =======================================================================

model Branch {
  id                  BigInt     @id @default(autoincrement())
  branchName          String     @map("branch_name") @db.VarChar(100)
  address             String     @db.VarChar(200)
  phoneNumber         String     @unique @map("phone_number") @db.VarChar(10)
  openingAt           DateTime   @default(dbgenerated("'08:00:00'::time")) @map("opening_at") @db.Time(6)
  closingAt           DateTime   @default(dbgenerated("'22:00:00'::time")) @map("closing_at") @db.Time(6)
  managerId           BigInt?    @unique @map("manager_id")
  
  createdAt           DateTime   @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime   @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  manager             Employee?          @relation(fields: [managerId], references: [id], onDelete: SetNull)
  mobilizations       Mobilization[]
  invoices            Invoice[]
  applyPromotions     ApplyPromotion[]
  medicineInventory   MedicineInventory[]
  vaccineInventory    VaccineInventory[]
  packageInventory    PackageInventory[]
  productInventory    ProductInventory[]
  appointments        Appointment[]

  @@map("branches")
}

// =======================================================================
// 5. MOBILIZATIONS (Lịch Sử Điều Động)
// =======================================================================

model Mobilization {
  id          BigInt    @id @default(autoincrement())
  employeeId  BigInt    @map("employee_id")
  branchId    BigInt    @map("branch_id")
  startDate   DateTime  @map("start_date") @db.Date
  endDate     DateTime? @map("end_date") @db.Date
  
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  employee    Employee  @relation(fields: [employeeId], references: [id], onDelete: Restrict)
  branch      Branch    @relation(fields: [branchId], references: [id], onDelete: Restrict)

  @@unique([employeeId, branchId, startDate])
  @@map("mobilizations")
}

// =======================================================================
// 6. INVOICES (Hóa Đơn)
// =======================================================================

model Invoice {
  id                         BigInt         @id @default(autoincrement())
  createdBy                  BigInt?        @map("created_by")
  branchId                   BigInt?        @map("branch_id")
  customerId                 BigInt?        @map("customer_id")
  paymentMethod              PaymentMethod  @map("payment_method")
  saleAttitudeRating         Int?           @map("sale_attitude_rating")
  overallSatisfactionRating  Int?           @map("overall_satisfaction_rating")
  totalAmount                Decimal        @default(0) @map("total_amount") @db.Decimal(15, 2)
  totalDiscount              Decimal        @default(0) @map("total_discount") @db.Decimal(15, 2)
  finalAmount                Decimal?       @map("final_amount") @db.Decimal(15, 2)
  
  createdAt                  DateTime       @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                  DateTime       @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  creator   Employee? @relation(fields: [createdBy], references: [id], onDelete: SetNull)
  branch    Branch?   @relation(fields: [branchId], references: [id], onDelete: Restrict)
  customer  User?     @relation(fields: [customerId], references: [id], onDelete: Restrict)
  services  Service[]

  @@map("invoices")
}

// =======================================================================
// 7. TYPES OF SERVICES (Loại Dịch Vụ)
// =======================================================================

model TypeOfService {
  type      ServiceType @id
  price     Decimal     @db.Decimal(15, 2)
  
  createdAt DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime    @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  services      Service[]
  promotionFor  PromotionFor[]

  @@map("types_of_services")
}

// =======================================================================
// 8. SERVICES (Dịch Vụ)
// =======================================================================

model Service {
  id                      BigInt       @id @default(autoincrement())
  invoiceId               BigInt?      @map("invoice_id")
  typeOfService           ServiceType? @map("type_of_service")
  qualityRating           Int?         @map("quality_rating")
  employeeAttitudeRating  Int?         @map("employee_attitude_rating")
  comment                 String?
  unitPrice               Decimal      @map("unit_price") @db.Decimal(15, 2)
  discountAmount          Decimal      @map("discount_amount") @db.Decimal(15, 2)
  finalAmount             Decimal?     @map("final_amount") @db.Decimal(15, 2)
  
  createdAt               DateTime     @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt               DateTime     @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  invoice             Invoice?            @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  serviceType         TypeOfService?      @relation(fields: [typeOfService], references: [type], onDelete: Restrict)
  medicalExamination  MedicalExamination?
  singleInjection     SingleInjection?
  packageInjection    PackageInjection?
  sellProduct         SellProduct?

  @@map("services")
}

// =======================================================================
// 9. PROMOTIONS (Ưu đãi)
// =======================================================================

model Promotion {
  id              BigInt              @id @default(autoincrement())
  description     String?
  applyFor        PromotionForLevel   @map("apply_for")
  
  createdAt       DateTime            @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime            @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  applyPromotions ApplyPromotion[]
  promotionFor    PromotionFor[]

  @@map("promotions")
}

// =======================================================================
// 10. APPLY PROMOTIONS (Áp Dụng Ưu Đãi)
// =======================================================================

model ApplyPromotion {
  id           BigInt   @id @default(autoincrement())
  promotionId  BigInt   @map("promotion_id")
  branchId     BigInt   @map("branch_id")
  startDate    DateTime @map("start_date") @db.Date
  endDate      DateTime @map("end_date") @db.Date
  
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  promotion Promotion @relation(fields: [promotionId], references: [id], onDelete: Cascade)
  branch    Branch    @relation(fields: [branchId], references: [id], onDelete: Restrict)

  @@unique([branchId, promotionId, startDate])
  @@map("apply_promotions")
}

// =======================================================================
// 11. PROMOTION FOR (Ưu Đãi Dành Cho)
// =======================================================================

model PromotionFor {
  id                  BigInt        @id @default(autoincrement())
  promotionId         BigInt        @map("promotion_id")
  serviceType         ServiceType   @map("service_type")
  discountPercentage  Int?          @map("discount_percentage")
  
  createdAt           DateTime      @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime      @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  promotion     Promotion       @relation(fields: [promotionId], references: [id], onDelete: Cascade)
  typeOfService TypeOfService   @relation(fields: [serviceType], references: [type], onDelete: Restrict)

  @@unique([promotionId, serviceType])
  @@map("promotion_for")
}

// =======================================================================
// 12. MEDICINES (Thuốc)
// =======================================================================

model Medicine {
  id               BigInt              @id @default(autoincrement())
  medicineName     String              @map("medicine_name") @db.VarChar(200)
  description      String?
  price            Decimal             @db.Decimal(15, 2)
  
  createdAt        DateTime            @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime            @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  prescriptions        Prescription[]
  medicineInventory    MedicineInventory[]

  @@map("medicines")
}

// =======================================================================
// 13. MEDICAL EXAMINATIONS (Khám Bệnh)
// =======================================================================

model MedicalExamination {
  serviceId        BigInt    @id @map("service_id")
  petId            BigInt    @map("pet_id")
  doctorId         BigInt    @map("doctor_id")
  diagnosis        String?
  conclusion       String?
  appointmentDate  DateTime? @map("appointment_date") @db.Timestamptz(6)
  
  createdAt        DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  service       Service        @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  pet           Pet            @relation(fields: [petId], references: [id], onDelete: Restrict)
  doctor        Employee       @relation(fields: [doctorId], references: [id], onDelete: Restrict)
  prescriptions Prescription[]

  @@map("medical_examinations")
}

// =======================================================================
// 14. PRESCRIPTIONS (Toa Thuốc)
// =======================================================================

model Prescription {
  id                    BigInt             @id @default(autoincrement())
  medicalExaminationId  BigInt             @map("medical_examination_id")
  medicineId            BigInt             @map("medicine_id")
  quantity              Int
  dosage                String             @db.VarChar(100)
  duration              String             @db.VarChar(100)
  instructions          String?
  
  createdAt             DateTime           @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt             DateTime           @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  medicalExamination MedicalExamination @relation(fields: [medicalExaminationId], references: [serviceId], onDelete: Cascade)
  medicine           Medicine           @relation(fields: [medicineId], references: [id], onDelete: Restrict)

  @@unique([medicalExaminationId, medicineId])
  @@map("prescriptions")
}

// =======================================================================
// 15. VACCINES (Vắc-xin)
// =======================================================================

model Vaccine {
  id               BigInt            @id @default(autoincrement())
  vaccineName      String            @map("vaccine_name") @db.VarChar(200)
  price            Decimal           @db.Decimal(15, 2)
  
  createdAt        DateTime          @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime          @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  includeVaccines   IncludeVaccine[]
  vaccineUses       VaccineUse[]
  vaccineInventory  VaccineInventory[]

  @@map("vaccines")
}

// =======================================================================
// 16. VACCINE PACKAGES (Gói Tiêm)
// =======================================================================

model VaccinePackage {
  id                BigInt               @id @default(autoincrement())
  packageName       String               @map("package_name") @db.VarChar(200)
  monthlyMilestone  Int                  @map("monthly_milestone")
  cycle             Int
  price             Decimal              @db.Decimal(15, 2)
  
  createdAt         DateTime             @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime             @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  includeVaccines      IncludeVaccine[]
  vaccinePackageUses   VaccinePackageUse[]
  packageInventory     PackageInventory[]

  @@map("vaccine_packages")
}

// =======================================================================
// 17. INCLUDE VACCINES (Thành Phần Gói)
// =======================================================================

model IncludeVaccine {
  id         BigInt         @id @default(autoincrement())
  packageId  BigInt         @map("package_id")
  vaccineId  BigInt         @map("vaccine_id")
  dosage     Int
  
  createdAt  DateTime       @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime       @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  package VaccinePackage @relation(fields: [packageId], references: [id], onDelete: Cascade)
  vaccine Vaccine        @relation(fields: [vaccineId], references: [id], onDelete: Restrict)

  @@unique([packageId, vaccineId])
  @@map("include_vaccines")
}

// =======================================================================
// 18. SINGLE INJECTIONS (Tiêm Mũi Lẻ)
// =======================================================================

model SingleInjection {
  serviceId BigInt   @id @map("service_id")
  petId     BigInt   @map("pet_id")
  doctorId  BigInt   @map("doctor_id")
  
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  service      Service      @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  pet          Pet          @relation(fields: [petId], references: [id], onDelete: Restrict)
  doctor       Employee     @relation(fields: [doctorId], references: [id], onDelete: Restrict)
  vaccineUses  VaccineUse[]

  @@map("single_injections")
}

// =======================================================================
// 19. PACKAGE INJECTIONS (Tiêm Theo Gói)
// =======================================================================

model PackageInjection {
  serviceId BigInt   @id @map("service_id")
  petId     BigInt   @map("pet_id")
  doctorId  BigInt   @map("doctor_id")
  
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  service             Service             @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  pet                 Pet                 @relation(fields: [petId], references: [id], onDelete: Restrict)
  doctor              Employee            @relation(fields: [doctorId], references: [id], onDelete: Restrict)
  vaccinePackageUses  VaccinePackageUse[]

  @@map("package_injections")
}

// =======================================================================
// 20. VACCINE USES (Sử Dụng Vắc-xin)
// =======================================================================

model VaccineUse {
  id                 BigInt          @id @default(autoincrement())
  singleInjectionId  BigInt?         @map("single_injection_id")
  vaccineId          BigInt          @map("vaccine_id")
  dosage             Int
  
  createdAt          DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime        @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  singleInjection SingleInjection? @relation(fields: [singleInjectionId], references: [serviceId], onDelete: Cascade)
  vaccine         Vaccine          @relation(fields: [vaccineId], references: [id], onDelete: Restrict)

  @@unique([singleInjectionId, vaccineId])
  @@map("vaccine_uses")
}

// =======================================================================
// 21. VACCINE PACKAGE USES (Sử Dụng Gói Tiêm)
// =======================================================================

model VaccinePackageUse {
  id                 BigInt           @id @default(autoincrement())
  packageInjectionId BigInt?          @map("package_injection_id")
  packageId          BigInt           @map("package_id")
  injectionNumber    Int              @map("injection_number")
  nextInjectionDate  DateTime?        @map("next_injection_date") @db.Date
  isCompleted        Boolean          @default(false) @map("is_completed")
  
  createdAt          DateTime         @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime         @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  packageInjection PackageInjection? @relation(fields: [packageInjectionId], references: [serviceId], onDelete: Cascade)
  package          VaccinePackage    @relation(fields: [packageId], references: [id], onDelete: Restrict)

  @@unique([packageInjectionId, injectionNumber])
  @@map("vaccine_package_uses")
}

// =======================================================================
// 22. PRODUCTS (Sản Phẩm)
// =======================================================================

model Product {
  id               BigInt            @id @default(autoincrement())
  productName      String            @map("product_name") @db.VarChar(200)
  productType      ProductType       @map("product_type")
  price            Decimal           @db.Decimal(15, 2)
  
  createdAt        DateTime          @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime          @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  sellProducts      SellProduct[]
  productInventory  ProductInventory[]

  @@map("products")
}

// =======================================================================
// 23. SELL PRODUCTS (Bán Sản Phẩm)
// =======================================================================

model SellProduct {
  serviceId BigInt   @id @map("service_id")
  productId BigInt   @map("product_id")
  quantity  Int
  
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Restrict)

  @@unique([serviceId, productId])
  @@map("sell_products")
}

// =======================================================================
// 24. MEDICINE INVENTORY (Kho Thuốc)
// =======================================================================

model MedicineInventory {
  id         BigInt   @id @default(autoincrement())
  branchId   BigInt   @map("branch_id")
  medicineId BigInt   @map("medicine_id")
  quantity   Int
  
  updatedAt  DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  branch   Branch   @relation(fields: [branchId], references: [id], onDelete: Restrict)
  medicine Medicine @relation(fields: [medicineId], references: [id], onDelete: Restrict)

  @@unique([branchId, medicineId])
  @@map("medicine_inventory")
}

// =======================================================================
// 25. VACCINE INVENTORY (Kho Vắc-xin)
// =======================================================================

model VaccineInventory {
  id        BigInt   @id @default(autoincrement())
  branchId  BigInt   @map("branch_id")
  vaccineId BigInt   @map("vaccine_id")
  quantity  Int
  
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  branch  Branch  @relation(fields: [branchId], references: [id], onDelete: Restrict)
  vaccine Vaccine @relation(fields: [vaccineId], references: [id], onDelete: Restrict)

  @@unique([branchId, vaccineId])
  @@map("vaccine_inventory")
}

// =======================================================================
// 26. PACKAGE INVENTORY (Kho Gói Tiêm)
// =======================================================================

model PackageInventory {
  id        BigInt   @id @default(autoincrement())
  branchId  BigInt   @map("branch_id")
  packageId BigInt   @map("package_id")
  quantity  Int
  
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  branch  Branch         @relation(fields: [branchId], references: [id], onDelete: Restrict)
  package VaccinePackage @relation(fields: [packageId], references: [id], onDelete: Restrict)

  @@unique([branchId, packageId])
  @@map("package_inventory")
}

// =======================================================================
// 27. PRODUCT INVENTORY (Kho Sản Phẩm)
// =======================================================================

model ProductInventory {
  id        BigInt   @id @default(autoincrement())
  branchId  BigInt   @map("branch_id")
  productId BigInt   @map("product_id")
  quantity  Int
  
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  branch  Branch  @relation(fields: [branchId], references: [id], onDelete: Restrict)
  product Product @relation(fields: [productId], references: [id], onDelete: Restrict)

  @@unique([branchId, productId])
  @@map("product_inventory")
}

// =======================================================================
// 28. APPOINTMENTS (Lịch Hẹn)
// =======================================================================

model Appointment {
  id               BigInt                  @id @default(autoincrement())
  petId            BigInt                  @map("pet_id")
  ownerId          BigInt                  @map("owner_id")
  branchId         BigInt                  @map("branch_id")
  doctorId         BigInt                  @map("doctor_id")
  serviceType      AppointmentServiceType  @map("service_type")
  appointmentTime  DateTime                @map("appointment_time") @db.Timestamptz(6)
  reason           String?
  status           Status                  @default(DangChoXacNhan)
  cancelledReason  String?                 @map("cancelled_reason")
  
  createdAt        DateTime                @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime                @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  pet    Pet      @relation(fields: [petId], references: [id], onDelete: Restrict)
  owner  User     @relation(fields: [ownerId], references: [id], onDelete: Restrict)
  branch Branch   @relation(fields: [branchId], references: [id], onDelete: Restrict)
  doctor Employee @relation(fields: [doctorId], references: [id], onDelete: Restrict)

  @@unique([petId, appointmentTime, serviceType])
  @@unique([doctorId, branchId, appointmentTime])
  @@map("appointments")
}